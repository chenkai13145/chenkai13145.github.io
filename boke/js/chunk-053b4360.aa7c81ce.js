(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-053b4360"],{"159b":function(t,a,e){var s=e("da84"),n=e("fdbc"),i=e("17c2"),o=e("9112");for(var r in n){var c=s[r],l=c&&c.prototype;if(l&&l.forEach!==i)try{o(l,"forEach",i)}catch(u){l.forEach=i}}},"17c2":function(t,a,e){"use strict";var s=e("b727").forEach,n=e("b301");t.exports=n("forEach")?function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}:[].forEach},"1ce8":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"common"},[e("p",{staticClass:"title"},[t._v("留言板")]),e("div",{staticClass:"postcom"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{rows:"6"},domProps:{value:t.content},on:{input:function(a){a.target.composing||(t.content=a.target.value)}}}),e("div",{staticClass:"top"},[e("span",[t._v(t._s(t.$store.getters.users.name?"欢迎~~"+t.$store.getters.users.name:"请先登录"))]),t.$store.getters.users.name?e("span",{staticClass:"login",on:{click:t.layout}},[t._v("退出")]):e("span",{staticClass:"login",on:{click:t.login}},[t._v("登录")])]),e("van-button",{attrs:{plain:"",type:"primary"},on:{click:t.postXin}},[t._v("发表评论")]),e("div",{staticClass:"bottomshow"},[t._l(t.arrcom,(function(a,s){return e("div",{key:a.time+s,staticClass:"show"},[e("div",{staticClass:"numbers"},[t._v(t._s(a.paiming)+"楼")]),e("div",{staticClass:"com"},[e("div",[e("div",{staticClass:"icon",style:"background-color:"+a.bgcolor+"; width: 50PX; height: 50PX;"},[t._v(t._s(a.one))])]),e("div",{staticClass:"hoshow"},[e("div",[e("p",{staticClass:"name"},[t._v(t._s(a.name)+" ("+t._s(t._f("filters")(a.time))+")")]),e("p",{staticClass:"texts"},[t._v(t._s(a.text))]),e("p",{staticClass:"huifu",on:{click:function(e){return t.copy(a._id,a.name)}}},[t._v("回复"),void 0!==t.$store.getters.users.id&&t.$store.getters.users.id===a.userid?e("strong",{staticClass:"del",on:{click:function(e){return e.stopPropagation(),t.delposts(a._id)}}},[t._v("删除")]):t._e()])]),t._l(a.comment,(function(s,n){return e("div",{key:s._id+n,staticClass:"hoshow hoshows"},[e("p",{staticClass:"name"},[t._v(t._s(s.name)+" ("+t._s(t._f("filters")(s.time))+")")]),e("p",{staticClass:"texts"},[t._v(t._s(s.text))]),e("p",{staticClass:"huifu",on:{click:function(e){return t.copy(a._id,a.name)}}},[t._v("回复")])])}))],2)])])})),e("van-button",{directives:[{name:"show",rawName:"v-show",value:t.loadingPage,expression:"loadingPage"}],staticClass:"jiazaibtn",attrs:{plain:"",type:"primary"},on:{click:t.pageLoading}},[t._v("加载更多")])],2),e("van-icon",{class:[t.music?"dsad musicadd":"musicadd"],attrs:{name:"music-o",size:"40"},on:{click:t.play}}),e("audio",{ref:"audio",attrs:{hidden:"",loop:""}})],1),e("van-dialog",{attrs:{beforeClose:t.beforeClose,title:"登录",width:t.winWidth>600?600:320,"show-cancel-button":""},model:{value:t.show,callback:function(a){t.show=a},expression:"show"}},[e("form",[e("van-cell-group",[e("van-field",{attrs:{required:"",clearable:"",label:"用户名",placeholder:"请输入用户名"},model:{value:t.name,callback:function(a){t.name=a},expression:"name"}}),e("van-field",{attrs:{type:"email",label:"邮箱",placeholder:"请输入邮箱",required:""},model:{value:t.email,callback:function(a){t.email=a},expression:"email"}}),e("van-field",{attrs:{type:"password",label:"密码",placeholder:"请输入密码",required:""},model:{value:t.password,callback:function(a){t.password=a},expression:"password"}})],1)],1)])],1)},n=[],i=(e("99af"),e("b0c0"),e("d3b7"),e("25f0"),e("4d90"),e("159b"),e("2909")),o=e("284b");function r(t){return Object(o["a"])({url:"/all",method:"get",params:t})}function c(t){return Object(o["a"])({url:"/post",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/delete",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/logReg",method:"post",data:t})}var d=e("8235"),h=e.n(d),m={data:function(){return{music:!0,arrcom:[],show:!1,winWidth:null,name:"",password:"",email:"",content:"",postId:"",Query:{size:10,page:0},loadingPage:!0}},deactivated:function(){this.music=!0,this.$refs.audio.src=null,this.$refs.audio.autoplay=null},activated:function(){var t=this;this.$nextTick((function(){t.play()}))},mounted:function(){window.innerWidth?this.winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(this.winWidth=document.body.clientWidth),this.getAllCom()},methods:{login:function(){this.show=!0},play:function(){this.music=!this.music,this.$refs.audio.src&&this.$refs.audio.autoplay?(this.$refs.audio.src=null,this.$refs.audio.autoplay=null):(this.$refs.audio.src=e("bc91"),this.$refs.audio.autoplay="autoplay")},getAllCom:function(){var t=this;r(this.Query).then((function(a){200===a.status&&(a.data.da.forEach((function(t,e){a.data.da[e].bgcolor="#"+Math.random().toString(16).substring(2,8),a.data.da[e].one=t.name.substring(0,1)})),a.data.da.length<t.Query.size&&(t.loadingPage=!1),0===t.Query.page&&(t.arrcom=[]),t.arrcom=[].concat(Object(i["a"])(t.arrcom),Object(i["a"])(a.data.da)))}))},copy:function(t,a){this.$store.getters.users.name?(this.postId=t,this.content="@回复"+a+":",document.getElementsByTagName("textarea")[0].focus()):this.$toast("请先登录")},beforeClose:function(t,a){var e=this;if("cancel"===t)return a();var s=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;if(this.name.length>=1&&this.password.length>=3&&s.test(this.email)){var n={name:this.name,email:this.email,password:this.password};u(n).then((function(t){if(console.log(t),200===t.status&&t.data.success){localStorage.setItem("token",t.data.token);var s=h()(t.data.token),n={jwttoken:s,done:a};e.$store.dispatch("saveToken",n)}else e.$toast(t.data.msg),a(!1)}))}else this.$toast("格式不正确"),a(!1)},postXin:function(){var t=this;if(this.$store.getters.users.name)if(this.content.length>=1){this.Query.page=0,this.loadingPage=!0;var a={id:this.postId,userid:this.$store.getters.users.id,name:this.$store.getters.users.name,text:this.content};c(a).then((function(a){t.content="",t.getAllCom()}))}else this.$toast("评论不能为空");else this.$toast("请先登录")},delposts:function(t){var a=this;l({id:t}).then((function(t){200===t.status&&t.data.success&&(a.$toast(t.data.msg),a.getAllCom())}))},pageLoading:function(){this.Query.page++,this.getAllCom()},layout:function(){this.$store.dispatch("layout")}},filters:{filters:function(t){var a=new Date(t),e=a.getFullYear(),s=(a.getMonth()+1).toString().padStart(2,0),n=a.getDate().toString().padStart(2,0);return"".concat(e,"-").concat(s,"-").concat(n)}}},f=m,p=(e("47b6"),e("2877")),g=Object(p["a"])(f,s,n,!1,null,null,null);a["default"]=g.exports},"2b5a":function(t,a,e){},"47b6":function(t,a,e){"use strict";var s=e("2b5a"),n=e.n(s);n.a},b0c0:function(t,a,e){var s=e("83ab"),n=e("9bf2").f,i=Function.prototype,o=i.toString,r=/^\s*function ([^ (]*)/,c="name";!s||c in i||n(i,c,{configurable:!0,get:function(){try{return o.call(this).match(r)[1]}catch(t){return""}}})},b301:function(t,a,e){"use strict";var s=e("d039");t.exports=function(t,a){var e=[][t];return!e||!s((function(){e.call(null,a||function(){throw 1},1)}))}},bc91:function(t,a,e){t.exports=e.p+"media/By2.0b464599.mp3"}}]);
//# sourceMappingURL=chunk-053b4360.aa7c81ce.js.map